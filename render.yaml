# =============================================================================
# Render Blueprint - Infrastructure as Code
# https://render.com/docs/blueprint-spec
# =============================================================================

services:
  - type: web
    name: paw-diary
    runtime: go

    region: singapore
    plan: free
    autoDeploy: true

    buildCommand: |
      apt-get update && apt-get install -y ffmpeg &&
      npm install --prefix frontend &&
      npm run build --prefix frontend &&
      go build -o main .

    startCommand: ./main

    envVars:
      - key: PORT
        value: 8080
      - key: STORAGE_PATH
        value: ./storage
      - key: AI_API_KEY
        sync: false  # Must be set manually in Render Dashboard (secret)
      - key: AI_API_ENDPOINT
        value: https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent

    healthCheckPath: /api/health
